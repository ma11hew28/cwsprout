<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
  .KEYW {color: #933;}
  .COMM {color: #bbb; font-style: italic;}
  .NUMB {color: #393;}
  .STRN {color: #393;}
  .REGX {color: #339;}
  .line {border-right: 1px dotted #666; color: #666; font-style: normal;}
  </style></head><body><pre><span class='line'>  1</span> <span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="COMM">// Validators</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="COMM">// Author: Charles Jolley</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="COMM">// ==========================================================================</span><span class="WHIT">
<span class='line'>  5</span> 
<span class='line'>  6</span> </span><span class="NAME">require</span><span class="PUNC">(</span><span class="STRN">'foundation/object'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  7</span> 
<span class='line'>  8</span> </span><span class="COMM">/**
<span class='line'>  9</span>   @class
<span class='line'> 10</span>   
<span class='line'> 11</span>   Validators provide a way for you to implement simple form field validation
<span class='line'> 12</span>   and transformation.  To use a validator, simply name the validator in the
<span class='line'> 13</span>   "validate" attribute in your text field.  For example, if you want to
<span class='line'> 14</span>   validate a field using the PhoneNumberValidator use this:
<span class='line'> 15</span> 
<span class='line'> 16</span>   &lt;input value="1234567890" validate="phone-number" />
<span class='line'> 17</span> 
<span class='line'> 18</span>   Validators get notified at three points.  You can implement one or all
<span class='line'> 19</span>   of these methods to support validation.  All of the validate methods except
<span class='line'> 20</span>   for validateKeypress behave the same way.  You are passed a form, field,
<span class='line'> 21</span>   and possibly the oldValue.  You are expected to return Validator.OK or
<span class='line'> 22</span>   an error string.  Inside this method you typically do one of all of the
<span class='line'> 23</span>   following:
<span class='line'> 24</span> 
<span class='line'> 25</span>   1. You can simply validate the field value and return OK or an error str
<span class='line'> 26</span>   
<span class='line'> 27</span>   2. You can modify the field value (for example, you could format the
<span class='line'> 28</span>      string to match some predefined format).
<span class='line'> 29</span>      
<span class='line'> 30</span>   3. If you need to roundtrip the server first to perform validation, you can
<span class='line'> 31</span>      return Validator.OK, then save the form and field info until after the
<span class='line'> 32</span>      roundtrip.  On return, if there is a problem, first verify the field
<span class='line'> 33</span>      value has not changed and then call form.errorFor(field,str) ;
<span class='line'> 34</span> 
<span class='line'> 35</span>   @extends SC.Object
<span class='line'> 36</span>   @author Charles Jolley
<span class='line'> 37</span>   @version 1.0
<span class='line'> 38</span> */</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="NAME">SC.Validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Object.extend</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="COMM">/** @scope SC.Validator.prototype */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 41</span> 
<span class='line'> 42</span>   </span><span class="COMM">// ..........................................</span><span class="WHIT">
<span class='line'> 43</span>   </span><span class="COMM">// OBJECT VALUE CONVERSION</span><span class="WHIT">
<span class='line'> 44</span>   </span><span class="COMM">//</span><span class="WHIT">
<span class='line'> 45</span>   </span><span class="COMM">// The following methods are used to convert the string value of a field</span><span class="WHIT">
<span class='line'> 46</span>   </span><span class="COMM">// to and from an object value.  The default implementations return</span><span class="WHIT">
<span class='line'> 47</span>   </span><span class="COMM">// the string, but you can override this to provide specific behaviors. </span><span class="WHIT">
<span class='line'> 48</span>   </span><span class="COMM">// For example, you might add or remove a dollar sign or convert the </span><span class="WHIT">
<span class='line'> 49</span>   </span><span class="COMM">// value to a number.</span><span class="WHIT">
<span class='line'> 50</span>   
<span class='line'> 51</span> </span><span class="COMM">/**
<span class='line'> 52</span>   Returns the value to set in the field for the passed object value.  
<span class='line'> 53</span>   
<span class='line'> 54</span>   The form and view to be set MAY (but will not always) be passed also.  You
<span class='line'> 55</span>   should override this method to help convert an input object into a value
<span class='line'> 56</span>   that can be displayed by the field.  For example, you might convert a 
<span class='line'> 57</span>   date to a property formatted string or a number to a properly formatted
<span class='line'> 58</span>   value.
<span class='line'> 59</span>   
<span class='line'> 60</span>   @param {Object} object The object to transform
<span class='line'> 61</span>   @param {SC.FormView} form The form this field belongs to. (optional)
<span class='line'> 62</span>   @param {SC.View} view The view the value is required for.
<span class='line'> 63</span>   @returns {Object} a value (usually a string) suitable for display
<span class='line'> 64</span> */</span><span class="WHIT">
<span class='line'> 65</span>   </span><span class="NAME">fieldValueForObject</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">object</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 66</span>   
<span class='line'> 67</span>   </span><span class="COMM">/**
<span class='line'> 68</span>     Returns the object value for the passed string.
<span class='line'> 69</span>     
<span class='line'> 70</span>     The form and view MAY (but wil not always) be passed also.  You should
<span class='line'> 71</span>     override this method to convert a field value, such as string, into an
<span class='line'> 72</span>     object value suitable for consumption by the rest of the app.  For example
<span class='line'> 73</span>     you may convert a string into a date or a number.
<span class='line'> 74</span>     
<span class='line'> 75</span>     @param {String} value the field value.  (Usually a String).
<span class='line'> 76</span>     @param {SC.FormView} form The form this field belongs to. (optional)
<span class='line'> 77</span>     @param {SC.View} view The view this value was pulled from.
<span class='line'> 78</span>     @returns {Object} an object suitable for consumption by the app.
<span class='line'> 79</span>   */</span><span class="WHIT">
<span class='line'> 80</span>   </span><span class="NAME">objectForFieldValue</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">view</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 81</span>   
<span class='line'> 82</span>   </span><span class="COMM">// ..........................................</span><span class="WHIT">
<span class='line'> 83</span>   </span><span class="COMM">// VALIDATION PRIMITIVES</span><span class="WHIT">
<span class='line'> 84</span>   </span><span class="COMM">//</span><span class="WHIT">
<span class='line'> 85</span> 
<span class='line'> 86</span>   </span><span class="COMM">/**
<span class='line'> 87</span>     Validate the field value.  
<span class='line'> 88</span>     
<span class='line'> 89</span>     You can implement standard behavior for your validator by using the
<span class='line'> 90</span>     vaidate and validateError methods.  validate() should return false
<span class='line'> 91</span>     if the field is not valid.
<span class='line'> 92</span> 
<span class='line'> 93</span>     @param {SC.FormView} form the form this view belongs to
<span class='line'> 94</span>     @param {SC.View} field the field to validate.  Responds to fieldValue.
<span class='line'> 95</span>     @returns {Boolean} YES if field is valid.
<span class='line'> 96</span>   */</span><span class="WHIT">
<span class='line'> 97</span>   </span><span class="NAME">validate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 98</span> 
<span class='line'> 99</span>   </span><span class="COMM">/**
<span class='line'>100</span>     Returns an error object if the field is invalid.
<span class='line'>101</span>   
<span class='line'>102</span>     This is the other standard validator method that can be used to impement
<span class='line'>103</span>     basic validation.  This should return an error object explaining why
<span class='line'>104</span>     the field is not valid.  It will only be called if validate() returned
<span class='line'>105</span>     false.
<span class='line'>106</span>   
<span class='line'>107</span>     @param {SC.FormView} form the form this view belongs to
<span class='line'>108</span>     @param {SC.View} field the field to validate.  Responds to fieldValue.
<span class='line'>109</span>     @returns {SC.Error} an error object
<span class='line'>110</span>   */</span><span class="WHIT">
<span class='line'>111</span>   </span><span class="NAME">validateError</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>112</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">$error</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>113</span>       </span><span class="STRN">"Invalid.General(%@)"</span><span class="PUNC">.</span><span class="NAME">loc</span><span class="PUNC">(</span><span class="NAME">field.get</span><span class="PUNC">(</span><span class="STRN">'fieldValue'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>114</span>       </span><span class="NAME">field.get</span><span class="PUNC">(</span><span class="STRN">'fieldKey'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>115</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>116</span> 
<span class='line'>117</span>   </span><span class="COMM">// ..........................................</span><span class="WHIT">
<span class='line'>118</span>   </span><span class="COMM">// VALIDATION API</span><span class="WHIT">
<span class='line'>119</span>   </span><span class="COMM">//</span><span class="WHIT">
<span class='line'>120</span> 
<span class='line'>121</span>   </span><span class="COMM">/**
<span class='line'>122</span>     Invoked just before the user ends editing of the field.
<span class='line'>123</span>   
<span class='line'>124</span>     The default implementation calls your validate() method and then
<span class='line'>125</span>     validateError() if valiate() returns NO.  This method should return 
<span class='line'>126</span>     SC.Validator.OK if validation succeeded or an error object if it fails.
<span class='line'>127</span>   
<span class='line'>128</span>     @param {SC.FormView} form the form for the field
<span class='line'>129</span>     @param {SC.View} field the field to validate
<span class='line'>130</span>     @param {Object} oldValue: the value of the field before the change
<span class='line'>131</span> 
<span class='line'>132</span>     @returns SC.Validator.OK or an error object.
<span class='line'>133</span>   
<span class='line'>134</span>   */</span><span class="WHIT">
<span class='line'>135</span>   </span><span class="NAME">validateChange</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oldValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>136</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.validate</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.Validator.OK</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.validateError</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>137</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>138</span> 
<span class='line'>139</span>   </span><span class="COMM">/**
<span class='line'>140</span>     Invoked just before the form is submitted.
<span class='line'>141</span>   
<span class='line'>142</span>     This method gives your validators one last chance to perform validation
<span class='line'>143</span>     on the form as a whole.  The default version does the same thing as the 
<span class='line'>144</span>     validateChange() method.
<span class='line'>145</span>   
<span class='line'>146</span>     @param {SC.FormView} form the form for the field
<span class='line'>147</span>     @param {SC.View} field the field to validate
<span class='line'>148</span> 
<span class='line'>149</span>     @returns SC.Validator.OK or an error object.
<span class='line'>150</span>   
<span class='line'>151</span>   */</span><span class="WHIT">  
<span class='line'>152</span>   </span><span class="NAME">validateSubmit</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>153</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.validate</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.Validator.OK</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.validateError</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>154</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>155</span> 
<span class='line'>156</span>   </span><span class="COMM">/**
<span class='line'>157</span>     Invoked 1ms after the user types a key (if a change is allowed).  
<span class='line'>158</span>   
<span class='line'>159</span>     You can use this validate the new partial string and return an error if 
<span class='line'>160</span>     needed. The default will validate a partial only if there was already an 
<span class='line'>161</span>     error. This allows the user to try to get it right before you bug them.
<span class='line'>162</span>   
<span class='line'>163</span>     Unlike the other methods, you should return SC.Validator.NO_CHANGE if you
<span class='line'>164</span>     did not actually validate the partial string.  If you return 
<span class='line'>165</span>     SC.Validator.OK then any showing errors will be hidden.
<span class='line'>166</span>   
<span class='line'>167</span>     @param {SC.FormView} form the form for the field
<span class='line'>168</span>     @param {SC.View} field the field to validate
<span class='line'>169</span> 
<span class='line'>170</span>     @returns SC.Validator.OK, SC.Validator.NO_CHANGE or an error object.
<span class='line'>171</span>   */</span><span class="WHIT">  
<span class='line'>172</span>   </span><span class="NAME">validatePartial</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 
<span class='line'>173</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">field.get</span><span class="PUNC">(</span><span class="STRN">'isValid'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>174</span>       </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.validate</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">SC.Validator.OK</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.validateError</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>175</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">SC.Validator.NO_CHANGE</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>176</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>177</span>   
<span class='line'>178</span>   </span><span class="COMM">/**
<span class='line'>179</span>     Invoked when the user presses a key.  
<span class='line'>180</span>   
<span class='line'>181</span>     This method is used to restrict the letters and numbers the user is 
<span class='line'>182</span>     allowed to enter.  You should not use this method to perform full 
<span class='line'>183</span>     validation on the field.  Instead use validatePartial().
<span class='line'>184</span>   
<span class='line'>185</span>     @param {SC.FormView} form the form for the field
<span class='line'>186</span>     @param {SC.View} field the field to validate
<span class='line'>187</span>     @param {String} char the characters being added
<span class='line'>188</span>     
<span class='line'>189</span>     @returns {Boolean} YES if allowed, NO otherwise
<span class='line'>190</span>   */</span><span class="WHIT">
<span class='line'>191</span>   </span><span class="NAME">validateKeypress</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">,</span><span class="NAME">charStr</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>192</span> 
<span class='line'>193</span>   </span><span class="COMM">// .....................................</span><span class="WHIT">
<span class='line'>194</span>   </span><span class="COMM">// OTHER METHODS</span><span class="WHIT">
<span class='line'>195</span> 
<span class='line'>196</span>   </span><span class="COMM">/**
<span class='line'>197</span>     Called on all validators when they are attached to a field.  
<span class='line'>198</span>   
<span class='line'>199</span>     You can use this to do any setup that you need.  The default does nothing.
<span class='line'>200</span>     
<span class='line'>201</span>     @param {SC.FormView} form the form for the field
<span class='line'>202</span>     @param {SC.View} field the field to validate
<span class='line'>203</span>   */</span><span class="WHIT">
<span class='line'>204</span>   </span><span class="NAME">attachTo</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>205</span> 
<span class='line'>206</span>   </span><span class="COMM">/**
<span class='line'>207</span>     Called on a validator just before it is removed from a field.  You can 
<span class='line'>208</span>     tear down any setup you did for the attachTo() method.
<span class='line'>209</span>     
<span class='line'>210</span>     @param {SC.FormView} form the form for the field
<span class='line'>211</span>     @param {SC.View} field the field to validate
<span class='line'>212</span>   */</span><span class="WHIT">
<span class='line'>213</span>   </span><span class="NAME">detachFrom</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>214</span> 
<span class='line'>215</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>216</span> 
<span class='line'>217</span> </span><span class="NAME">SC.Validator.mixin</span><span class="PUNC">(</span><span class="COMM">/** @scope SC.Validator */</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>218</span> 
<span class='line'>219</span>   </span><span class="COMM">/**
<span class='line'>220</span>     Return value when validation was performed and value is OK.
<span class='line'>221</span>   */</span><span class="WHIT">
<span class='line'>222</span>   </span><span class="NAME">OK</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> 
<span class='line'>223</span>   
<span class='line'>224</span>   </span><span class="COMM">/**
<span class='line'>225</span>     Return value when validation was not performed.
<span class='line'>226</span>   */</span><span class="WHIT">
<span class='line'>227</span>   </span><span class="NAME">NO_CHANGE</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">  
<span class='line'>228</span> 
<span class='line'>229</span>   </span><span class="COMM">/**
<span class='line'>230</span>     Invoked by a field whenever a validator is attached to the field.
<span class='line'>231</span>     
<span class='line'>232</span>     The passed validatorKey can be a validator instance, a validator class
<span class='line'>233</span>     or a string naming a validator. To make your validator
<span class='line'>234</span>     visible, you should name your validator under the SC.Validator base.
<span class='line'>235</span>     for example SC.Validator.Number would get used for the 'number' 
<span class='line'>236</span>     validator key.
<span class='line'>237</span>   
<span class='line'>238</span>     This understands validatorKey strings in the following format:
<span class='line'>239</span> 
<span class='line'>240</span>     * 'key' or 'multiple_words' will find validators Key and MultipleWords
<span class='line'>241</span> 
<span class='line'>242</span>     * if you want to share a single validator among multiple fields (for
<span class='line'>243</span>       example to validate that two passwords are the same) set a name inside
<span class='line'>244</span>       brackets. i.e. 'password[pwd]'.
<span class='line'>245</span> 
<span class='line'>246</span>     @param {SC.FormView} form the form for the field
<span class='line'>247</span>     @param {SC.View} field the field to validate
<span class='line'>248</span>     @param {Object} validatorKey the key to validate
<span class='line'>249</span>     
<span class='line'>250</span>     @returns {SC.Validaotr} validator instance or null
<span class='line'>251</span>   */</span><span class="WHIT">  
<span class='line'>252</span>   </span><span class="NAME">findFor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">validatorKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>253</span>     
<span class='line'>254</span>     </span><span class="COMM">// Convert the validator into a validator instance.</span><span class="WHIT">
<span class='line'>255</span>     </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>256</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">validatorKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// nothing to do...</span><span class="WHIT">
<span class='line'>257</span>     
<span class='line'>258</span>     </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">validatorKey</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">SC.Validator</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>259</span>       </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorKey</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>260</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">validatorKey.isClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>261</span>       </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorKey.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>262</span>       
<span class='line'>263</span>     </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">$type</span><span class="PUNC">(</span><span class="NAME">validatorKey</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">T_STRING</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>264</span> 
<span class='line'>265</span>       </span><span class="COMM">// extract optional key name</span><span class="WHIT">
<span class='line'>266</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>267</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorKey.match</span><span class="PUNC">(</span><span class="REGX">/^(.+)\[(.*)\]/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>268</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>269</span>         </span><span class="NAME">validatorKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>270</span>       </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>271</span>       
<span class='line'>272</span>       </span><span class="COMM">// convert the validatorKey name into a class.</span><span class="WHIT">
<span class='line'>273</span>       </span><span class="NAME">validatorKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">validatorKey</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">camelize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>274</span>       </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">validatorClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SC.Validator</span><span class="PUNC">[</span><span class="NAME">validatorKey</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>275</span>       </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">validatorClass</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>276</span>         </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"validator %@ not found for %@"</span><span class="PUNC">.</span><span class="NAME">fmt</span><span class="PUNC">(</span><span class="NAME">validatorKey</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>277</span>         </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>278</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>279</span> 
<span class='line'>280</span>         </span><span class="COMM">// if a key was also passed, then find the validator in the list of</span><span class="WHIT">
<span class='line'>281</span>         </span><span class="COMM">// validators for the form.  Otherwise, just create a new instance.</span><span class="WHIT">
<span class='line'>282</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">form</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>283</span>           </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="STRN">"named validator (%@) could not be found for field %@ because the field does not belong to a form"</span><span class="PUNC">.</span><span class="NAME">fmt</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>284</span>           </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>285</span>         </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>286</span>         
<span class='line'>287</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">form._validatorHash</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">form._validatorHash</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>288</span>         </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">form._validatorHash</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>289</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">validator</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorClass.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>290</span>         </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">form._validatorHash</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>291</span>       </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">validatorClass.create</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>292</span>     </span><span class="PUNC">}</span><span class="WHIT"> 
<span class='line'>293</span>     
<span class='line'>294</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">validator</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>295</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>296</span>   
<span class='line'>297</span>   </span><span class="COMM">/**
<span class='line'>298</span>     Convenience class method to call the fieldValueForObject() instance
<span class='line'>299</span>     method you define in your subclass.
<span class='line'>300</span>   */</span><span class="WHIT">
<span class='line'>301</span>   </span><span class="NAME">fieldValueForObject</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>302</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.prototype.fieldValueForObject</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">,</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>303</span>   </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>304</span> 
<span class='line'>305</span>   </span><span class="COMM">/**
<span class='line'>306</span>     Convenience class method to call the objectForFieldValue() instance
<span class='line'>307</span>     method you define in your subclass.
<span class='line'>308</span>   */</span><span class="WHIT">
<span class='line'>309</span>   </span><span class="NAME">objectForFieldValue</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">form</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>310</span>     </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.prototype.objectForFieldValue</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="NAME">form</span><span class="PUNC">,</span><span class="NAME">field</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>311</span>   </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>312</span>   
<span class='line'>313</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>314</span> 
<span class='line'>315</span> </span></pre></body></html>